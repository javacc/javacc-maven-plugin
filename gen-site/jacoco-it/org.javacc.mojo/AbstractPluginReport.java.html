<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AbstractPluginReport.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Integration tests coverage</a> &gt; <a href="index.source.html" class="el_package">org.javacc.mojo</a> &gt; <span class="el_source">AbstractPluginReport.java</span></div><h1>AbstractPluginReport.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2025-2026, Marc Mazas &lt;mazas.marc@gmail.com&gt;.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright notice,
 *       this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the names of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived from
 *       this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 * THE POSSIBILITY OF SUCH DAMAGE.
 */
package org.javacc.mojo;

import java.io.File;
import java.io.IOException;
import java.util.Arrays;
import java.util.List;
import java.util.Locale;
import java.util.ResourceBundle;
import org.apache.maven.doxia.sink.Sink;
import org.apache.maven.plugins.annotations.Parameter;
import org.apache.maven.reporting.AbstractMavenReport;
import org.apache.maven.reporting.MavenReportException;

/**
 * Super class, managing common plugin-level parameters and methods, of the concrete mojos that
 * generate report files, either:
 * &lt;ul&gt;
 * &lt;li&gt;directly as a standalone mojo (through the {@link #execute()} method), or&lt;/li&gt;
 * &lt;li&gt;indirectly from the web site generation (through the {@link #executeReport(Locale)}
 * method).&lt;/li&gt;
 * &lt;/ul&gt;
 * Much of a copy of {@link AbstractPluginMojo}, but extending another maven class.
 *
 * &lt;p&gt;
 * Each subclass manages a goal that
 *
 * &lt;ul&gt;
 * &lt;li&gt;manages the corresponding processor(s) command line arguments (options) as maven parameters,
 * with the help of corresponding beans, and
 * &lt;li&gt;triggers execution of one or more processors.
 * &lt;/ul&gt;
 *
 * &lt;p&gt;
 * One can set a specific log level for all classes of this plugin (without setting the global
 * &lt;code&gt;-X&lt;/code&gt; argument) through the (standard maven SLF4J Simple configuration) property&lt;br&gt;
 * &lt;code&gt;-Dorg.slf4j.simpleLogger.log.org.javacc.mojo=debug&lt;/code&gt;.&lt;br&gt;
 *
 * @since 3.8.0
 * @author Maͫzͣaͬsͨ
 * @see AbstractProcessor
 * @see AbstractArgumentsBean
 */
<span class="fc" id="L71">public abstract class AbstractPluginReport extends AbstractMavenReport {</span>
  
  /**
   * The set of Ant-like exclusion patterns used to prevent certain files from being processed.&lt;br&gt;
   * By default, this set is empty such that no files are excluded.
   */
  @Parameter //
  protected String[] excludes;
  
  /**
   * The fail on plugin error flag.&lt;br&gt;
   * It governs governs how the plugin will handle the errors it encountered on general
   * configuration (i.e. parameters not related to grammars).&lt;br&gt;
   * Possible values are &lt;code&gt;true&lt;/code&gt; and &lt;code&gt;false&lt;/code&gt;.&lt;br&gt;
   * On an error: if set to &lt;code&gt;false&lt;/code&gt;, the error message is displayed, the execution
   * terminates, but the plugin does not report an error for the current execution (i.e. it
   * continues with the next execution);&lt;br&gt;
   * if set to &lt;code&gt;true&lt;/code&gt; the error message is displayed, the execution terminates and the
   * plugin reports an error for the build.
   */
  @Parameter(property = &quot;javacc.failOnPluginError&quot;, defaultValue = &quot;true&quot;) //
  protected Boolean failOnPluginError;
  
  /**
   * The fail on grammar error parameter.&lt;br&gt;
   * It governs governs how the plugin will handle the errors it encountered while trying to read a
   * grammar file to retrieve the parser name (and the parser package for languages that use it)
   * (and in an execution the plugin may process zero, one or many grammars).&lt;br&gt;
   * Possible values are &lt;code&gt;first&lt;/code&gt;, &lt;code&gt;last&lt;/code&gt; and &lt;code&gt;ignore&lt;/code&gt;.&lt;br&gt;
   * If set to &lt;code&gt;first&lt;/code&gt;, the error message is displayed, the plugin stops processing other
   * grammars and reports an error for the build;&lt;br&gt;
   * if set to &lt;code&gt;last&lt;/code&gt;, the error message is displayed, the plugin continues processing
   * other grammars and at the end it reports an error for the build;&lt;br&gt;
   * if set to &lt;code&gt;ignore&lt;/code&gt; the error message(s) is(are) displayed but the plugin does not
   * report an error for the current execution (i.e. it continues with the next execution).
   */
  @Parameter(property = &quot;javacc.failOnGrammarError&quot;, defaultValue = &quot;first&quot;) //
  protected String failOnGrammarError;
  
  /**
   * The fail on processor error parameter.&lt;br&gt;
   * It governs how the plugin will handle the errors returned by the processor invocations and the
   * plugin post-processor copy operations (in an execution the plugin may process zero, one or many
   * grammars and invoke one or more processors for each).&lt;br&gt;
   * Possible values are &lt;code&gt;first&lt;/code&gt;, &lt;code&gt;last&lt;/code&gt; and &lt;code&gt;ignore&lt;/code&gt;.&lt;br&gt;
   * If set to &lt;code&gt;first&lt;/code&gt;, the error message is displayed, the plugin stops processing other
   * grammars and reports an error for the build;&lt;br&gt;
   * if set to &lt;code&gt;last&lt;/code&gt;, the error message is displayed, the plugin continues processing
   * other grammars and at the end it reports an error for the build;&lt;br&gt;
   * if set to &lt;code&gt;ignore&lt;/code&gt; the error message(s) is(are) displayed but the plugin does not
   * report an error for the current execution (i.e. it continues with the next execution).
   */
  @Parameter(property = &quot;javacc.failOnProcessorError&quot;, defaultValue = &quot;first&quot;) //
  protected String failOnProcessorError;
  
  /**
   * The set of Ant-like inclusion patterns used to select files from the source directory for
   * processing.&lt;br&gt;
   * By default, the pattern is:&lt;br&gt;
   * &lt;code&gt;**&amp;#47;*.jj&lt;/code&gt;, &lt;code&gt;**&amp;#47;*.jjt&lt;/code&gt;, &lt;code&gt;**&amp;#47;*.jtb&lt;/code&gt; for the
   * &lt;code&gt;jjdoc&lt;/code&gt; goal.
   */
<span class="fc" id="L133">  @Parameter //</span>
  protected String[] includes = null;
  
  /**
   * The skip processing flag.&lt;br&gt;
   * If true, no goal will not be executed.
   */
  @Parameter(property = &quot;javacc.skip&quot;, defaultValue = &quot;false&quot;) //
  protected Boolean skip;
  
  /**
   * The directories where the grammar files are located.&lt;br&gt;
   * They all must exist and be directories, otherwise a plugin error will be raised.&lt;br&gt;
   * These directories will be recursively scanned for input files to pass to JavaCC.&lt;br&gt;
   * Note that they will be under a common configuration; so if one wants a pom to process source
   * directories with different configuration, he must configure multiple executions with different
   * source directories.&lt;br&gt;
   * The parameters &lt;code&gt;includes&lt;/code&gt; and &lt;code&gt;excludes&lt;/code&gt; can be used to select a subset
   * of the files.&lt;br&gt;
   * If not absolute paths, maven internals considers they ar relative to &lt;code&gt;${basedir}&lt;/code&gt;
   * and converts them accordingly to absolute paths (i.e. &lt;code&gt;src/main/javacc&lt;/code&gt; will be
   * considered as &lt;code&gt;${basedir}/src/main/javacc&lt;/code&gt;, but &lt;code&gt;/src/main/javacc&lt;/code&gt; will
   * be considered as an absolute path, usually leading to an error.&lt;br&gt;
   * The default value, adequate for a user written grammar, but not for a generated (by a
   * preprocessor) grammar, is the array:&lt;br&gt;
   * &lt;code&gt;${basedir}/src/main/javacc&lt;/code&gt;, &lt;code&gt;${basedir}/src/main/jjtree&lt;/code&gt;,
   * &lt;code&gt;${basedir}/src/main/jtb&lt;/code&gt;.
   */
<span class="fc" id="L161">  @Parameter(property = &quot;javacc.sourceDirectories&quot;) //</span>
  protected List&lt;File&gt; sourceDirectories = null;
  
  /**
   * Abstract getter.
   *
   * @return the grammar file encoding option value, or the default encoding if no option, never
   *         &lt;code&gt;null&lt;/code&gt;
   */
  protected abstract String getGrammarFileEncoding();
  
  /**
   * Flag telling if initialization has been performed.&lt;br&gt;
   * Necessary, as {@link #canGenerateReport()} and {@link #executeReport(Locale)} can be called
   * together on the same mojo instance, {@link #executeReport(Locale)} directly by the site plugin
   * goal and or indirectly from the subclass mojo goal through (bottom-&gt;up)
   * {@link #generate(Sink, org.apache.maven.doxia.sink.SinkFactory, Locale)} /
   * {@link #reportToMarkup()} or {@link #reportToSite()} / {@link #execute()}, which itself calls
   * {@link #canGenerateReport()}.
   */
<span class="fc" id="L181">  private boolean initDone = false;</span>
  
  /**
   * Initialize the mojo.
   * 
   * @throws PluginException - for an error in initialization
   */
  public void initialize() throws PluginException {
<span class="fc" id="L189">    checkOptions();</span>
<span class="fc" id="L190">    initProcessor();</span>
<span class="fc" id="L191">    initDone = true;</span>
<span class="fc" id="L192">  }</span>
  
  @Override
  public boolean canGenerateReport() {
    
<span class="fc" id="L197">    getLog().debug(&quot;Entering canGenerateReport()&quot;);</span>
    
<span class="pc bpc" id="L199" title="1 of 2 branches missed.">    if (skip) {</span>
<span class="nc" id="L200">      getLog().info(&quot;Skipping processing as requested&quot;);</span>
<span class="nc" id="L201">      return false;</span>
    }
    
    try {
<span class="pc bpc" id="L205" title="1 of 2 branches missed.">      if (!initDone) {</span>
<span class="fc" id="L206">        initialize();</span>
      }
    }
<span class="fc" id="L209">    catch (final PluginException e) {</span>
      try {
        // failOnPluginError == 'true' will throw a MavenReportException
<span class="fc" id="L212">        handlePluginException(e);</span>
        // failOnPluginError == 'false' will continue here
      }
<span class="fc" id="L215">      catch (final MavenReportException mre) {</span>
        // in both cases we return false
<span class="fc" id="L217">      }</span>
<span class="fc" id="L218">      return false;</span>
<span class="fc" id="L219">    }</span>
    
<span class="pc bpc" id="L221" title="1 of 2 branches missed.">    for (final File dir : sourceDirectories) {</span>
<span class="fc" id="L222">      final String[] files = dir.list();</span>
<span class="pc bpc" id="L223" title="2 of 4 branches missed.">      if (files != null &amp;&amp; files.length &gt; 0) {</span>
<span class="fc" id="L224">        getLog().debug(&quot;canGenerateReport() on sourceDirectories '&quot;</span>
<span class="fc" id="L225">            + displayDirectories(sourceDirectories) + &quot;' returns true&quot;);</span>
<span class="fc" id="L226">        return true;</span>
      }
<span class="nc" id="L228">    }</span>
<span class="nc" id="L229">    getLog().debug(&quot;canGenerateReport() on sourceDirectories '&quot;</span>
<span class="nc" id="L230">        + displayDirectories(sourceDirectories) + &quot;' returns false&quot;);</span>
<span class="nc" id="L231">    return false;</span>
  }
  
  @Override
  public void executeReport(final Locale locale) throws MavenReportException {
    
<span class="fc" id="L237">    getLog().debug(</span>
<span class="fc" id="L238">        &quot;Entering executeReport(final Locale locale), locale is '&quot; + locale.getDisplayName() + &quot;'&quot;);</span>
    
<span class="pc bpc" id="L240" title="1 of 2 branches missed.">    if (skip) {</span>
<span class="nc" id="L241">      getLog().info(&quot;Skipping processing as requested&quot;);</span>
<span class="nc" id="L242">      return;</span>
    }
    
    try {
<span class="pc bpc" id="L246" title="1 of 2 branches missed.">      if (!initDone) {</span>
<span class="nc" id="L247">        initialize();</span>
      }
    }
<span class="nc" id="L250">    catch (final PluginException e) {</span>
      // failOnPluginError == 'true' will throw a MavenReportException
<span class="nc" id="L252">      handlePluginException(e);</span>
      // failOnPluginError == 'false' will continue here
<span class="nc" id="L254">      return;</span>
<span class="fc" id="L255">    }</span>
    
<span class="fc" id="L257">    final Sink sink = getSink();</span>
<span class="fc" id="L258">    createReportHeader(getBundle(locale), sink);</span>
    
<span class="fc" id="L260">    List&lt;GrammarInfo&gt; grammarInfos = null;</span>
    try {
<span class="fc" id="L262">      grammarInfos = scanForGrammars();</span>
    }
<span class="nc" id="L264">    catch (final GrammarException e) {</span>
      // 'ignore' for failOnGrammarError should not lead to throwing a GrammarException
      // 'first' and 'last' for failOnGrammarError must lead to throw a MojoExecutionException
<span class="nc" id="L267">      getLog().error(e.getMessage() + &quot; while failOnGrammarError is '&quot; + failOnGrammarError + &quot;'&quot;);</span>
<span class="nc" id="L268">      throw new MavenReportException(e.getMessage() /*, e*/);</span>
<span class="fc" id="L269">    }</span>
    
<span class="fc bfc" id="L271" title="All 2 branches covered.">    if (grammarInfos == null //</span>
<span class="pc bpc" id="L272" title="1 of 2 branches missed.">        || grammarInfos.size() == 0) {</span>
<span class="fc" id="L273">      String msg = &quot;No grammars to process in source directories '&quot;;</span>
<span class="fc" id="L274">      msg += displayDirectories(sourceDirectories);</span>
<span class="fc" id="L275">      msg += &quot;'&quot;;</span>
<span class="fc" id="L276">      getLog().info(msg);</span>
<span class="fc" id="L277">      return;</span>
    }
    
<span class="fc" id="L280">    int nb = 0;</span>
<span class="fc bfc" id="L281" title="All 2 branches covered.">    for (final GrammarInfo gi : grammarInfos) {</span>
      try {
<span class="fc" id="L283">        processGrammar(gi);</span>
      }
<span class="nc" id="L285">      catch (final ProcessorException e) {</span>
<span class="nc" id="L286">        handleProcessorException(e);</span>
<span class="fc" id="L287">      }</span>
<span class="fc" id="L288">      createReportLink(sink, gi);</span>
<span class="fc" id="L289">      nb++;</span>
<span class="fc" id="L290">    }</span>
    
<span class="fc" id="L292">    createReportFooter(sink);</span>
<span class="fc" id="L293">    sink.flush();</span>
<span class="fc" id="L294">    sink.close();</span>
    
<span class="fc" id="L296">    getLog().info(&quot;Processed &quot; + nb + &quot; grammar(s) successfully and &quot; + (grammarInfos.size() - nb)</span>
        + &quot; with errors&quot;);
    
<span class="pc bpc" id="L299" title="1 of 2 branches missed.">    if (processorErrorToIgnore) {</span>
      // failOnProcessorError == 'ignore'
<span class="nc" id="L301">      return;</span>
<span class="pc bpc" id="L302" title="1 of 2 branches missed.">    } else if (processorErrorFailure) {</span>
      // failOnProcessorError == 'last'
<span class="nc" id="L304">      throw new MavenReportException(</span>
          &quot;Returning a build error as encountered one or more processor exceptions&quot;);
    }
<span class="fc" id="L307">  }</span>
  
  /**
   * Create the header and title for the HTML report page.
   *
   * @param bundle - the resource bundle with the text.
   * @param sink The sink to write to the main report file.
   */
  protected abstract void createReportHeader(ResourceBundle bundle, Sink sink);
  
  /**
   * Create the HTML footer for the report page.
   *
   * @param sink The sink to write the HTML report page.
   */
  protected abstract void createReportFooter(Sink sink);
  
  /**
   * Create a table row containing a link to the JJDoc report for a grammar file.
   *
   * @param sink - the sink to write the report
   * @param grammarInfo - the grammar file information
   */
  protected abstract void createReportLink(Sink sink, GrammarInfo grammarInfo);
  
  /**
   * Get the resource bundle for the report text.
   *
   * @param locale - the locale to use for this report
   * @return The resource bundle
   */
  protected abstract ResourceBundle getBundle(Locale locale);
  
  /** True to tell the caller to ignore the grammar processing error. */
<span class="fc" id="L341">  private boolean processorErrorToIgnore = false;</span>
  
  /**
   * True to tell {@link #execute()} to return a build failure on grammar processing 'last' error.
   */
<span class="fc" id="L346">  private boolean processorErrorFailure = false;</span>
  
  /**
   * Transforms the plugin configuration exception in a build error if the plugin is configured to
   * fail on plugin configuration errors, otherwise just logs the error.
   *
   * @param e - the plugin configuration exception
   * @throws MavenReportException if the plugin is configured to fail on plugin configuration error
   */
  private void handlePluginException(final PluginException e) throws MavenReportException {
<span class="fc bfc" id="L356" title="All 2 branches covered.">    if (failOnPluginError) {</span>
<span class="fc" id="L357">      getLog().error(e.getMessage());</span>
<span class="fc" id="L358">      throw new MavenReportException(e.getMessage() /*, e*/);</span>
    } else {
<span class="fc" id="L360">      getLog().error(e.getMessage());</span>
<span class="fc" id="L361">      getLog().info(&quot;Continuing to next execution as failOnPluginError is set to 'false'&quot;);</span>
    }
<span class="fc" id="L363">  }</span>
  
  /**
   * Transforms the grammar processing exception in a build error if the plugin is configured to
   * fail on 'first' grammar processing error, otherwise logs the error and sets flags for 'last'
   * and 'ignore' values.
   *
   * @param e - the grammar processing exception
   * @throws MavenReportException if the plugin is configured to fail on grammar processing error
   */
  private void handleProcessorException(final ProcessorException e) throws MavenReportException {
<span class="nc bnc" id="L374" title="All 2 branches missed.">    if (&quot;first&quot;.equals(failOnProcessorError)) {</span>
<span class="nc" id="L375">      getLog().error(e.getMessage());</span>
<span class="nc" id="L376">      throw new MavenReportException(e.getMessage() /*, e*/);</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">    } else if (&quot;last&quot;.equals(failOnProcessorError)) {</span>
<span class="nc" id="L378">      processorErrorFailure = true;</span>
<span class="nc" id="L379">      getLog().error(e.getMessage());</span>
<span class="nc" id="L380">      getLog().info(&quot;Continuing current execution as failOnProcessorError is set to 'last'&quot;);</span>
    } else { // 'ignore'
<span class="nc" id="L382">      processorErrorToIgnore = true;</span>
<span class="nc" id="L383">      getLog().error(e.getMessage());</span>
<span class="nc" id="L384">      getLog().info(&quot;Continuing to next execution as failOnProcessorError is set to 'ignore'&quot;);</span>
    }
<span class="nc" id="L386">  }</span>
  
  /**
   * Checks valid values for different options.
   *
   * @throws PluginException if sourceDirectory does not exist or is not a directory
   */
  protected void checkOptions() throws PluginException {
    
    /* sourceDirectories */
    // here it can be null; if so it will be initialized to a default value by each processor;
    // and if not null, maven internals seems to always convert relative paths to an absolute ones
<span class="fc" id="L398">    getLog().debug(&quot;sourceDirectories is '&quot; + displayDirectories(sourceDirectories) + &quot;'&quot;);</span>
<span class="pc bpc" id="L399" title="1 of 2 branches missed.">    if (sourceDirectories != null) {</span>
<span class="fc bfc" id="L400" title="All 2 branches covered.">      for (final File dir : sourceDirectories) {</span>
<span class="fc bfc" id="L401" title="All 2 branches covered.">        if (!dir.exists()) {</span>
<span class="fc" id="L402">          throw new PluginException(&quot;sourceDirectory '&quot; + dir + &quot;' does not exist&quot;);</span>
<span class="pc bpc" id="L403" title="1 of 2 branches missed.">        } else if (!dir.isDirectory()) {</span>
<span class="nc" id="L404">          throw new PluginException(&quot;sourceDirectory '&quot; + dir + &quot;' is not a directory&quot;);</span>
        }
<span class="fc" id="L406">      }</span>
    }
    
    /* failOnPluginError */
<span class="fc" id="L410">    getLog().debug(&quot;failOnPluginError is '&quot; + failOnPluginError + &quot;'&quot;);</span>
    
    /* failOnGrammarError */
<span class="fc bfc" id="L413" title="All 2 branches covered.">    switch (failOnGrammarError.toLowerCase()) {</span>
    case &quot;first&quot;:
    case &quot;last&quot;:
    case &quot;ignore&quot;:
<span class="fc" id="L417">      failOnGrammarError = failOnGrammarError.toLowerCase();</span>
<span class="fc" id="L418">      getLog().debug(&quot;failOnGrammarError is '&quot; + failOnGrammarError + &quot;'&quot;);</span>
<span class="fc" id="L419">      break;</span>
    default:
<span class="fc" id="L421">      getLog().warn(&quot;invalid value '&quot; + failOnGrammarError</span>
          + &quot;' for failOnGrammarError parameter; must be 'first', 'last' or 'ignore';&quot;
          + &quot; kept to default 'first'&quot;);
<span class="fc" id="L424">      failOnGrammarError = &quot;first&quot;;</span>
      break;
    }
    
    /* failOnProcessorError */
<span class="fc bfc" id="L429" title="All 2 branches covered.">    switch (failOnProcessorError.toLowerCase()) {</span>
    case &quot;first&quot;:
    case &quot;last&quot;:
    case &quot;ignore&quot;:
<span class="fc" id="L433">      failOnProcessorError = failOnProcessorError.toLowerCase();</span>
<span class="fc" id="L434">      getLog().debug(&quot;failOnProcessorError is '&quot; + failOnProcessorError + &quot;'&quot;);</span>
<span class="fc" id="L435">      break;</span>
    default:
<span class="fc" id="L437">      getLog().warn(&quot;invalid value '&quot; + failOnProcessorError</span>
          + &quot;' for failOnProcessorError parameter; must be 'first', 'last' or 'ignore';&quot;
          + &quot; kept to default 'first'&quot;);
<span class="fc" id="L440">      failOnProcessorError = &quot;first&quot;;</span>
      break;
    }
<span class="fc" id="L443">  }</span>
  
  /**
   * Initializes (some default values specific to the processor(s) and those ones).
   *
   * @throws PluginException if invalid option value
   */
  protected abstract void initProcessor() throws PluginException;
  
  /**
   * Scans the source directories for grammar files which need processing.
   *
   * @return a list of grammar infos describing the found grammar files, may be &lt;code&gt;null&lt;/code&gt; if
   *         no grammar in the directory
   * @throws GrammarException if some grammar file could not be read or parsed
   */
  protected List&lt;GrammarInfo&gt; scanForGrammars() throws GrammarException {
<span class="fc" id="L460">    getLog().debug(&quot;Scanning for grammars in '&quot; + displayDirectories(sourceDirectories) + &quot;'&quot;);</span>
<span class="fc" id="L461">    final GrammarDirectoryScanner gds = //</span>
<span class="fc" id="L462">        new GrammarDirectoryScanner(getLog(), null, null);</span>
<span class="fc" id="L463">    gds.dsSetExcludes(excludes);</span>
<span class="fc" id="L464">    gds.dsSetIncludes(includes);</span>
<span class="fc" id="L465">    gds.setJarsLastTS(-1L);</span>
<span class="fc" id="L466">    gds.setOutputDirectories(null);</span>
<span class="fc" id="L467">    gds.setTimestampDeltaMs(-1L);</span>
<span class="fc" id="L468">    List&lt;GrammarInfo&gt; grammarInfos = null;</span>
<span class="fc bfc" id="L469" title="All 2 branches covered.">    for (final File dir : sourceDirectories) {</span>
<span class="fc" id="L470">      gds.dsSetBasedir(dir);</span>
<span class="fc" id="L471">      final List&lt;GrammarInfo&gt; grInfos = gds.scanForGrammars(failOnGrammarError);</span>
<span class="pc bpc" id="L472" title="1 of 4 branches missed.">      if (grInfos != null &amp;&amp; grInfos.size() &gt; 0) {</span>
<span class="fc bfc" id="L473" title="All 2 branches covered.">        if (grammarInfos == null) {</span>
<span class="fc" id="L474">          grammarInfos = grInfos;</span>
        } else {
<span class="fc" id="L476">          grammarInfos.addAll(grInfos);</span>
        }
      }
<span class="fc" id="L479">    }</span>
<span class="fc bfc" id="L480" title="All 2 branches covered.">    getLog().debug(&quot;Found grammars: &quot;</span>
<span class="fc" id="L481">        + (grammarInfos == null ? &quot;none&quot; : Arrays.toString(grammarInfos.toArray())));</span>
<span class="fc" id="L482">    return grammarInfos;</span>
  }
  
  /**
   * Abstract getter.
   *
   * @return the array of absolute paths to the directories where the (current) processor will
   *         output its generated files, never &lt;code&gt;null&lt;/code&gt;
   */
  protected abstract File[] getProcessorOutputDirectories();
  
  /**
   * Tells the subclass to process the specified grammar file (it may execute one or more
   * processors).
   *
   * @param grammarInfo - the grammar info describing the grammar file to process, must not be
   *          &lt;code&gt;null&lt;/code&gt;
   * @throws ProcessorException if the invocation of the processor(s) failed or if the processor(s)
   *           reported a non-zero exit code or if the generated files could not be copied
   */
  protected abstract void processGrammar(GrammarInfo grammarInfo) throws ProcessorException;
  
  /**
   * @param directories - a list of directories
   * @return the string of the comma separated list of directories
   */
  protected static String displayDirectories(final List&lt;File&gt; directories) {
<span class="pc bpc" id="L509" title="1 of 2 branches missed.">    if (directories == null) {</span>
<span class="nc" id="L510">      return null;</span>
    }
<span class="fc" id="L512">    String msg = &quot;&quot;;</span>
<span class="fc bfc" id="L513" title="All 2 branches covered.">    for (int i = 0; i &lt; directories.size(); i++) {</span>
      try {
<span class="fc" id="L515">        msg += directories.get(i).getCanonicalPath();</span>
      }
<span class="nc" id="L517">      catch (final IOException e) {</span>
<span class="nc" id="L518">        msg += &quot;IOException on element of sourceDirectories&quot;;</span>
<span class="fc" id="L519">      }</span>
<span class="fc bfc" id="L520" title="All 2 branches covered.">      if (i &lt; directories.size() - 1) {</span>
<span class="fc" id="L521">        msg += &quot;, &quot;;</span>
      }
    }
<span class="fc" id="L524">    return msg;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span>Integration tests coverage report</div></body></html>